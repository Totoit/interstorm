/*
 *  jQuery Date Dropdowns - v1.0.0
 *  A simple, customisable date select plugin
 *
 *  Made by Chris Brown
 *  Under MIT License
 */
!function(e,t,a,i){"use strict";var n="dateDropdowns",s={defaultDate:null,defaultDateFormat:"yyyy-mm-dd",displayFormat:"dmy",submitFormat:"yyyy-mm-dd",minAge:0,maxAge:120,minYear:null,maxYear:null,submitFieldName:"date",wrapperClass:"date-dropdowns",dropdownClass:null,daySuffixes:!0,monthSuffixes:!0,monthFormat:"long",required:!1,dayLabel:"Day",monthLabel:"Month",yearLabel:"Year",monthLongValues:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShortValues:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],initialDayMonthYearValues:["Day","Month","Year"],daySuffixValues:["st","nd","rd","th"]};function r(t,a){return this.element=t,this.$element=e(t),this.config=e.extend({},s,a),this.internals={objectRefs:{}},this.init(),this}e.extend(r.prototype,{init:function(){this.checkForDuplicateElement(),this.setInternalVariables(),this.setupMarkup(),this.buildDropdowns(),this.attachDropdowns(),this.bindChangeEvent(),this.config.defaultDate&&this.populateDefaultDate()},checkForDuplicateElement:function(){return!e('input[name="'+this.config.submitFieldName+'"]').length||(e.error("Duplicate element found"),!1)},setInternalVariables:function(){var e=new Date;this.internals.currentDay=e.getDate(),this.internals.currentMonth=e.getMonth()+1,this.internals.currentYear=e.getFullYear()},setupMarkup:function(){var t,a;if("input"===this.element.tagName.toLowerCase()){this.config.defaultDate||(this.config.defaultDate=this.element.value),a=this.$element.attr("type","hidden").wrap('<div class="'+this.config.wrapperClass+'"></div>');var i=this.config.submitFieldName!==s.submitFieldName;this.element.hasAttribute("name")||i?i&&this.$element.attr("name",this.config.submitFieldName):this.$element.attr("name",s.submitFieldName),t=this.$element.parent()}else a=e("<input/>",{type:"hidden",name:this.config.submitFieldName}),this.$element.append(a).addClass(this.config.wrapperClass),t=this.$element;return this.internals.objectRefs.pluginWrapper=t,this.internals.objectRefs.hiddenField=a,!0},buildDropdowns:function(){var e,t,a;return r.message={day:this.config.initialDayMonthYearValues[0],month:this.config.initialDayMonthYearValues[1],year:this.config.initialDayMonthYearValues[2]},e=this.buildDayDropdown(),this.internals.objectRefs.dayDropdown=e,t=this.buildMonthDropdown(),this.internals.objectRefs.monthDropdown=t,a=this.buildYearDropdown(),this.internals.objectRefs.yearDropdown=a,!0},attachDropdowns:function(){var e=this.internals.objectRefs.pluginWrapper,t=this.internals.objectRefs.dayDropdown,a=this.internals.objectRefs.monthDropdown,i=this.internals.objectRefs.yearDropdown;switch(this.config.displayFormat){case"mdy":e.append(a,t,i);break;case"ymd":e.append(i,a,t);break;case"dmy":default:e.append(t,a,i)}return!0},bindChangeEvent:function(){var e=this.internals.objectRefs.dayDropdown,t=this.internals.objectRefs.monthDropdown,a=this.internals.objectRefs.yearDropdown,i=this,n=this.internals.objectRefs;n.pluginWrapper.on("change","select",function(){var s,r,o=e.val(),l=t.val(),d=a.val();if(s=i.checkDate(o,l,d))return n.dayDropdown.addClass("invalid"),!1;"00"!==n.dayDropdown.val()&&n.dayDropdown.removeClass("invalid"),n.hiddenField.val(""),s||o*l*d==0||(r=i.formatSubmitDate(o,l,d),n.hiddenField.val(r)),n.hiddenField.change()})},populateDefaultDate:function(){var e=this.config.defaultDate,t=[],a="",i="",n="";switch(this.config.defaultDateFormat){case"yyyy-mm-dd":default:a=(t=e.split("-"))[2],i=t[1],n=t[0];break;case"dd/mm/yyyy":a=(t=e.split("/"))[0],i=t[1],n=t[2];break;case"mm/dd/yyyy":a=(t=e.split("/"))[1],i=t[0],n=t[2];break;case"unix":(t=new Date).setTime(1e3*e),a=t.getDate()+"",i=t.getMonth()+1+"",n=t.getFullYear(),a.length<2&&(a="0"+a),i.length<2&&(i="0"+i)}return this.internals.objectRefs.dayDropdown.val(a),this.internals.objectRefs.monthDropdown.val(i),this.internals.objectRefs.yearDropdown.val(n),this.internals.objectRefs.hiddenField.val(e),!0===this.checkDate(a,i,n)&&this.internals.objectRefs.dayDropdown.addClass("invalid"),!0},buildBaseDropdown:function(t){var a=t;return this.config.dropdownClass&&(a+=" "+this.config.dropdownClass),e("<select></select>",{class:a,name:this.config.submitFieldName+"_["+t+"]",required:this.config.required})},buildDayDropdown:function(){for(var e,t=this.buildBaseDropdown("day"),i=a.createElement("option"),n=1;n<10;n++)e=this.config.daySuffixes?n+this.getSuffix(n):"0"+n,(i=a.createElement("option")).setAttribute("value","0"+n),i.appendChild(a.createTextNode(e)),t.append(i);for(var s=10;s<=31;s++)e=s,this.config.daySuffixes&&(e=s+this.getSuffix(s)),(i=a.createElement("option")).setAttribute("value",s),i.appendChild(a.createTextNode(e)),t.append(i);return t},buildMonthDropdown:function(){for(var e=this.buildBaseDropdown("month"),t=a.createElement("option"),i=1;i<=12;i++){var n;switch(this.config.monthFormat){case"short":n=this.config.monthShortValues[i-1];break;case"long":n=this.config.monthLongValues[i-1];break;case"numeric":n=i,this.config.monthSuffixes&&(n+=this.getSuffix(i))}i<10&&(i="0"+i),(t=a.createElement("option")).setAttribute("value",i),t.appendChild(a.createTextNode(n)),e.append(t)}return e},buildYearDropdown:function(){var e=this.config.minYear,t=this.config.maxYear,i=this.buildBaseDropdown("year"),n=a.createElement("option");e||(e=this.internals.currentYear-(this.config.maxAge+1)),t||(t=this.internals.currentYear-this.config.minAge);for(var s=t;s>=e;s--)(n=a.createElement("option")).setAttribute("value",s),n.appendChild(a.createTextNode(s)),i.append(n);return i},getSuffix:function(e){var t="",a=this.config.daySuffixValues[0],i=this.config.daySuffixValues[1],n=this.config.daySuffixValues[2],s=this.config.daySuffixValues[3];switch(e%10){case 1:t=e%100==11?s:a;break;case 2:t=e%100==12?s:i;break;case 3:t=e%100==13?s:n;break;default:t="th"}return t},checkDate:function(e,t,a){var i;if("00"!==t){var n=new Date(a,t,0).getDate(),s=parseInt(e,10);(i=this.updateDayOptions(n,s))&&this.internals.objectRefs.hiddenField.val("")}return i},updateDayOptions:function(e,t){var i=parseInt(this.internals.objectRefs.dayDropdown.children(":last").val(),10),n="",s="",r=!1;if(i>e){for(;i>e;)this.internals.objectRefs.dayDropdown.children(":last").remove(),i--;t>e&&(r=!0)}else if(i<e)for(;i<e;){s=n=++i,this.config.daySuffixes&&(s+=this.getSuffix(i));var o=a.createElement("option");o.setAttribute("value",n),o.appendChild(a.createTextNode(s)),this.internals.objectRefs.dayDropdown.append(o)}return r},formatSubmitDate:function(e,t,a){var i,n;switch(this.config.submitFormat){case"unix":(n=new Date).setDate(e),n.setMonth(t-1),n.setYear(a),i=Math.round(n.getTime()/1e3);break;default:i=this.config.submitFormat.replace("dd",e).replace("mm",t).replace("yyyy",a)}return i},destroy:function(){var e=this.config.wrapperClass;if(this.$element.hasClass(e))this.$element.empty();else{var t=this.$element.parent().find("select");this.$element.unwrap(),t.remove()}}}),e.fn[n]=function(t){return this.each(function(){if("string"==typeof t){var a=Array.prototype.slice.call(arguments,1),i=e.data(this,"plugin_"+n);if(void 0===i)return e.error("Please initialize the plugin before calling this method."),!1;i[t].apply(i,a)}else e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new r(this,t))}),this}}(jQuery,window,document);